{"version":3,"file":"ldod-export-wc.js","sources":["../../ldod-ui/buttons/export-btn/ldod-export-wc.js","../../ldod-ui/buttons/export-btn/ldod-export.js"],"sourcesContent":["/** @format */\nimport buttonsCss from '@ui/bootstrap/buttons-css.js';\nimport rootCss from '@ui/bootstrap/root-css.js';\nimport style from './style.css?inline';\nimport ExportComponent from './ldod-export.js';\nimport { requestProxy } from '@core';\nimport { errorPublisher } from '../events-module';\n\nfunction base64ToBuffer(data) {\n\treturn new Uint8Array(\n\t\tatob(data)\n\t\t\t.split('')\n\t\t\t.map(c => c.charCodeAt(0))\n\t).buffer;\n}\n\nexport class LdodExport extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.attachShadow({ mode: 'open' });\n\t\tthis.sheet = new CSSStyleSheet();\n\t\tthis.sheet.replaceSync(rootCss + buttonsCss + style);\n\t\tthis.shadowRoot.adoptedStyleSheets = [this.sheet];\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['title', 'width'];\n\t}\n\n\tget title() {\n\t\treturn this.getAttribute('title');\n\t}\n\n\tget width() {\n\t\treturn this.getAttribute('width') ?? '';\n\t}\n\n\tget filePrefix() {\n\t\treturn this.getAttribute('file-prefix');\n\t}\n\n\tget fileType() {\n\t\treturn this.getAttribute('file-type');\n\t}\n\n\tget method() {\n\t\treturn this.getAttribute('method') || 'GET';\n\t}\n\n\tconnectedCallback() {\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tthis.shadowRoot.innerHTML = ExportComponent({ title: this.title });\n\t\tthis.addEventListeners();\n\t}\n\n\taddEventListeners = () => {\n\t\tthis.shadowRoot.querySelector('button').onclick = this.handleSubmit;\n\t};\n\n\thandleSubmit = async e => {\n\t\te.preventDefault();\n\t\tconst res = await requestProxy[this.method.toLowerCase()]?.(\n\t\t\t{ path: this.dataset.url },\n\t\t\tthis.method === 'POST' ? this.body : ''\n\t\t);\n\n\t\tif (res && !res.xmlData && res.ok !== undefined) {\n\t\t\terrorPublisher('error', res.message);\n\t\t\treturn;\n\t\t}\n\n\t\tconst blob = new Blob([base64ToBuffer(res?.xmlData)], {\n\t\t\ttype: `application/${this.fileType || 'xml'}`,\n\t\t});\n\n\t\tconst a = document.createElement('a');\n\t\ta.href = window.URL.createObjectURL(blob);\n\t\ta.download = `${this.filePrefix}-${new Date().getFullYear()}-${\n\t\t\tnew Date().getMonth() + 1\n\t\t}-${new Date().getDate()}.${this.fileType || 'xml'}`;\n\t\ta.click();\n\t};\n\n\tattributeChangedCallback(name, oldV, newV) {\n\t\tthis.handleChangeAttribute[name](oldV, newV);\n\t}\n\n\thandleChangeAttribute = {\n\t\ttitle: (oldV, newV) => {\n\t\t\tif (oldV && oldV !== newV)\n\t\t\t\tthis.shadowRoot.querySelector('button#exportBtn>span[label]').textContent =\n\t\t\t\t\tthis.title;\n\t\t},\n\t\twidth: () => {\n\t\t\tthis.sheet.insertRule(`button {width: ${this.width};}`);\n\t\t\tthis.shadowRoot.adoptedStyleSheets = [this.sheet];\n\t\t},\n\t};\n}\n!customElements.get('ldod-export') && customElements.define('ldod-export', LdodExport);\n","export default ({ title }) => {\n  return /*html*/ `\n    <button class=\"btn btn-primary ellipsis\" type=\"button\" id=\"exportBtn\">\n      <span class=\"icon icon-export\"></span>\n      <span label>${title}</span>\n    </button>\n  `;\n};\n"],"names":["LdodExport","HTMLElement","constructor","this","attachShadow","mode","sheet","CSSStyleSheet","replaceSync","rootCss","buttonsCss","shadowRoot","adoptedStyleSheets","observedAttributes","title","getAttribute","width","filePrefix","fileType","method","connectedCallback","render","innerHTML","ExportComponent","addEventListeners","querySelector","onclick","handleSubmit","async","e","preventDefault","res","requestProxy","toLowerCase","path","dataset","url","body","xmlData","ok","errorPublisher","message","blob","Blob","data","Uint8Array","atob","split","map","c","charCodeAt","buffer","type","a","document","createElement","href","window","URL","createObjectURL","download","Date","getFullYear","getMonth","getDate","click","attributeChangedCallback","name","oldV","newV","handleChangeAttribute","textContent","insertRule","customElements","get","define"],"mappings":"iKAgBO,MAAMA,UAAmBC,YAC/BC,sBAECC,KAAKC,aAAa,CAAEC,KAAM,SAC1BF,KAAKG,MAAQ,IAAIC,cACjBJ,KAAKG,MAAME,YAAYC,EAAUC,8uBACjCP,KAAKQ,WAAWC,mBAAqB,CAACT,KAAKG,MAC3C,CAEUO,gCACH,MAAA,CAAC,QAAS,QACjB,CAEGC,YACI,OAAAX,KAAKY,aAAa,QACzB,CAEGC,YACI,OAAAb,KAAKY,aAAa,UAAY,EACrC,CAEGE,iBACI,OAAAd,KAAKY,aAAa,cACzB,CAEGG,eACI,OAAAf,KAAKY,aAAa,YACzB,CAEGI,aACI,OAAAhB,KAAKY,aAAa,WAAa,KACtC,CAEDK,oBACCjB,KAAKkB,QACL,CAEDA,SACMlB,KAAAQ,WAAWW,UCtDH,GAAGR,MAAAA,KAAK,iJAIHA,8BDkDUS,CAAgB,CAAET,MAAOX,KAAKW,QAC1DX,KAAKqB,mBACL,CAEDA,kBAAoB,KACnBrB,KAAKQ,WAAWc,cAAc,UAAUC,QAAUvB,KAAKwB,YAAA,EAGxDA,aAAeC,MAAMC,IACpBA,EAAEC,iBACF,MAAMC,QAAYC,EAAa7B,KAAKgB,OAAOc,iBAC1C,CAAEC,KAAM/B,KAAKgC,QAAQC,KACL,SAAhBjC,KAAKgB,OAAoBhB,KAAKkC,KAAO,KAGtC,GAAIN,IAAQA,EAAIO,cAAsB,IAAXP,EAAIQ,GAE9B,YADAC,EAAe,QAAST,EAAIU,SAIvBC,MAAAA,EAAO,IAAIC,KAAK,EAlEAC,EAkEgBb,GAAKO,QAjErC,IAAIO,WACVC,KAAKF,GACHG,MAAM,IACNC,KAAIC,GAAKA,EAAEC,WAAW,MACvBC,SA6DqD,CACrDC,KAAM,eAAejD,KAAKe,UAAY,UAGjCmC,EAAIC,SAASC,cAAc,KAtEnC,IAAwBX,EAuEtBS,EAAEG,KAAOC,OAAOC,IAAIC,gBAAgBjB,GACpCW,EAAEO,SAAW,GAAGzD,KAAKc,eAAc,IAAI4C,MAAOC,kBAC7C,IAAID,MAAOE,WAAa,UACjBF,MAAOG,aAAa7D,KAAKe,UAAY,QAC7CmC,EAAEY,OAAK,EAGRC,yBAAyBC,EAAMC,EAAMC,GACpClE,KAAKmE,sBAAsBH,GAAMC,EAAMC,EACvC,CAEDC,sBAAwB,CACvBxD,MAAO,CAACsD,EAAMC,KACTD,GAAQA,IAASC,IACpBlE,KAAKQ,WAAWc,cAAc,gCAAgC8C,YAC7DpE,KAAKW,MAAA,EAERE,MAAO,KACDb,KAAAG,MAAMkE,WAAW,kBAAkBrE,KAAKa,WAC7Cb,KAAKQ,WAAWC,mBAAqB,CAACT,KAAKG,MAAK,IAIlDmE,eAAeC,IAAI,gBAAkBD,eAAeE,OAAO,cAAe3E"}