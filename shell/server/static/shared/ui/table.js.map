{"version":3,"file":"table.js","sources":["../../ldod-core/helpers.js","../../ldod-ui/table/events-module.js","../../ldod-ui/table/table-component.js","../../ldod-ui/table/debounce.js","../../ldod-ui/table/table.js"],"sourcesContent":["/** @format */\n\nexport const sleep = async ms => new Promise(r => setTimeout(r, ms));\nexport const htmlRender = (...rawHtml) => document.createRange().createContextualFragment(rawHtml);\nglobalThis.htmlRender = htmlRender;\nglobalThis.sleep = sleep;\n","/** @format */\n\nconst { eventBus } = globalThis;\n\nexport const loadingPublisher = payload => eventBus?.publish('ldod:loading', payload);\n\n// TODO\n\n// register ldod:table-increased and ldod:table-searched\n// define json data schema\n// implement publishers\n// check subscribers\n","/** @format */\n\nimport toolsStyle from './tools.css?inline';\nimport tableStyle from './table.css?inline';\n\nexport function tableComponent(root) {\n\tconst div = document.createElement('div');\n\tdiv.innerHTML = /*html */ `\n    <style>${tableStyle}</style>\n    <div id=\"table-tools\">${root.searchKey ? searchTool() : ''}</div>\n    <div class=\"table-container\">\n      <div class=\"table-body\">\n        <table id=${root.id} class=\"${root.classes}\">\n          <thead></thead>\n          <tbody></tbody>\n        </table>\n      </div>\n    </div> \n  `;\n\n\tdiv.querySelector('thead').appendChild(tableHeaders(root.headers, root.getConstants));\n\tdiv.querySelector('tbody').append(...tableBody(root));\n\n\treturn div.childNodes;\n}\n\nfunction searchTool() {\n\treturn /*html*/ `\n      <style>${toolsStyle}</style>\n      <input\n        id=\"table-search-field\"\n        type=\"search\"\n        name=\"search\"\n        placeholder=\"search\"\n      />\n  `;\n}\n\nfunction tableHeaders(headers, constants) {\n\tconst tr = document.createElement('tr');\n\ttr.append(\n\t\t...headers.map(key => {\n\t\t\tconst th = document.createElement('th');\n\t\t\tth.classList.add('th-inner');\n\t\t\tth.setAttribute('data-key', key);\n\t\t\treturn appender(th, constants(key));\n\t\t})\n\t);\n\treturn tr;\n}\n\nfunction tableBody(root) {\n\tif (!root.data.length) return '';\n\treturn tableRows(root, 0, root.interval);\n}\n\nexport function tableRows(root, start, end) {\n\treturn root.data.slice(start, end).map(row => {\n\t\troot.lastIndex += 1;\n\t\treturn getRow(row, root);\n\t});\n}\n\nexport function getRow(row, root) {\n\tconst entry = row.data && typeof row.data === 'function' ? row.data() : row;\n\tconst tr = document.createElement('tr');\n\ttr.toggleAttribute('searched', true);\n\ttr.setAttribute('id', row[root.searchKey] || '');\n\ttr.append(...root.headers.map(key => rowCell(entry[key])));\n\treturn tr;\n}\n\nfunction rowCell(cellData) {\n\tconst cell = document.createElement('td');\n\tlet inner = typeof cellData === 'function' ? cellData() : cellData;\n\treturn appender(cell, inner);\n}\n\nfunction appender(parent, child) {\n\tif (child instanceof Node) parent.appendChild(child);\n\telse if (Symbol.iterator in Object(child)) parent.append(...child);\n\telse parent.textContent = child || '';\n\tparent.normalize();\n\treturn parent;\n}\n","let timeoutId;\n\nfunction clear() {\n\tclearTimeout(timeoutId);\n\ttimeoutId = undefined;\n}\n\nexport function debounce(delay, fn) {\n\tif (timeoutId) clear();\n\ttimeoutId = setTimeout(() => {\n\t\tfn();\n\t\tclear();\n\t}, delay);\n}\n","/** @format */\n\nimport { sleep } from '../../ldod-core/helpers';\nimport { loadingPublisher } from './events-module.js';\nimport { getRow, tableComponent, tableRows } from './table-component.js';\nimport { debounce } from './debounce.js';\n\nexport class LdodTable extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.lastIndex = 0;\n\t\tthis.getRow = getRow.bind();\n\t}\n\n\tget classes() {\n\t\treturn this.getAttribute('classes');\n\t}\n\n\tget numberOfVisibleRows() {\n\t\treturn +(this.dataset.rows ?? 20);\n\t}\n\n\tget isFullyLoaded() {\n\t\treturn this.data.length <= this.numberOfVisibleRows || this.lastIndex === this.data.length;\n\t}\n\n\tget interval() {\n\t\treturn this.data.length < this.numberOfVisibleRows\n\t\t\t? this.data.length\n\t\t\t: this.numberOfVisibleRows;\n\t}\n\n\tget language() {\n\t\treturn this.getAttribute('language');\n\t}\n\n\tget searchKey() {\n\t\treturn this.dataset.searchkey;\n\t}\n\n\tget searchInput() {\n\t\treturn this.querySelector('input#table-search-field');\n\t}\n\n\tget targetToObserve() {\n\t\tlet rows = this.querySelectorAll('table>tbody>tr');\n\t\tlet nrOfTr = rows.length;\n\t\treturn rows[Math.floor(nrOfTr * 0.75)];\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['language'];\n\t}\n\n\tget searchedRows() {\n\t\treturn this.allRows.filter(row => row.hasAttribute('searched'));\n\t}\n\tget unSearchedRows() {\n\t\treturn this.allRows.filter(row => !row.hasAttribute('searched'));\n\t}\n\tget allRows() {\n\t\treturn Array.from(this.querySelectorAll('table>tbody>tr'));\n\t}\n\n\tconnectedCallback() {\n\t\tthis.render();\n\t\tthis.handleLazyRenderRows();\n\t\thistory.state?.searchTerm && this.handleSearchInput();\n\t}\n\n\trender() {\n\t\tthis.append(...tableComponent(this));\n\t\tthis.addEventListeners();\n\t}\n\n\tgetConstants = key => {\n\t\tif (!this.constants) return key;\n\t\tconst constant = this.language ? this.constants[this.language][key] : this.constants[key];\n\t\treturn constant || key;\n\t};\n\n\taddEventListeners = () => {\n\t\tthis.searchInput?.addEventListener('input', () => debounce(500, this.handleSearchInput));\n\t};\n\n\thandleLazyRenderRows = () => {\n\t\tif (!this.isFullyLoaded) this.addObserver();\n\t};\n\n\tattributeChangedCallback(name, oldV, newV) {\n\t\tthis.onChangeAttribute[name](oldV, newV);\n\t}\n\n\tonChangeAttribute = {\n\t\tlanguage: (oldV, newV) => {\n\t\t\tif (oldV && oldV !== newV) {\n\t\t\t\tthis.querySelectorAll('[data-key]').forEach(ele => {\n\t\t\t\t\tele.firstChild.textContent = this.getConstants(ele.dataset.key);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t};\n\n\tobsCallback = ([entry], observer) => {\n\t\tif (entry.intersectionRatio > 0) {\n\t\t\tobserver.unobserve(entry.target);\n\t\t\tthis.addRows();\n\t\t\tif (!this.isFullyLoaded) observer.observe(this.targetToObserve);\n\t\t}\n\t};\n\n\taddObserver() {\n\t\tconst obs = new IntersectionObserver(this.obsCallback);\n\t\tobs.observe(this.targetToObserve);\n\t\tthis.observer = obs;\n\t\treturn obs;\n\t}\n\n\taddRows = end => {\n\t\tconst rows = tableRows(this, this.lastIndex, end ?? this.lastIndex + this.interval);\n\t\tthis.querySelector('table>tbody').append(...rows);\n\t\tthis.dispatchCustomEvent('ldod-table-increased');\n\t};\n\n\tloadSearchStyle() {\n\t\timport('./tools.css?inline').then(style => {\n\t\t\tthis.querySelector('#table-tools>style').innerHTML = style.default;\n\t\t});\n\t}\n\n\thandleSearchInput = async () => {\n\t\tif (this.isSearching) return;\n\t\tthis.isSearching = true;\n\t\tloadingPublisher(true);\n\t\tawait sleep(10);\n\n\t\tif (!this.isFullyLoaded) {\n\t\t\tthis.observer.disconnect();\n\t\t\tthis.addRows(this.data.length);\n\t\t}\n\n\t\tconst searchTerm = this.querySelector('input#table-search-field')\n\t\t\t.value?.trim()\n\t\t\t.toLowerCase()\n\t\t\t.toString();\n\n\t\thistory.replaceState(searchTerm ? { searchTerm } : {}, {});\n\t\tconst result = searchTerm\n\t\t\t? this.data\n\t\t\t\t\t.filter(row => {\n\t\t\t\t\t\tconst search =\n\t\t\t\t\t\t\ttypeof row.search === 'string'\n\t\t\t\t\t\t\t\t? row.search.toLowerCase()\n\t\t\t\t\t\t\t\t: row.search.toString().toLowerCase();\n\t\t\t\t\t\treturn search.includes(searchTerm);\n\t\t\t\t\t})\n\t\t\t\t\t.map(row => row[this.dataset.searchkey].toString())\n\t\t\t: this.data.map(row => row[this.dataset.searchkey].toString());\n\n\t\tthis.querySelectorAll('tbody>tr').forEach(row =>\n\t\t\trow.toggleAttribute('searched', result.indexOf(row.id) !== -1)\n\t\t);\n\n\t\tthis.dispatchCustomEvent('ldod-table-searched', {\n\t\t\tid: this.id,\n\t\t\tsize: result.length,\n\t\t});\n\t\tloadingPublisher(false);\n\t\tthis.isSearching = false;\n\t};\n\n\tdispatchCustomEvent = (event, detail) => {\n\t\tthis.dispatchEvent(new CustomEvent(event, { detail, bubbles: true, composed: true }));\n\t};\n}\n\n!customElements.get('ldod-table') && customElements.define('ldod-table', LdodTable);\n"],"names":["sleep","async","ms","Promise","r","setTimeout","globalThis","htmlRender","rawHtml","document","createRange","createContextualFragment","eventBus","loadingPublisher","payload","publish","tableComponent","root","div","createElement","innerHTML","searchKey","toolsStyle","id","classes","querySelector","appendChild","headers","constants","tr","append","map","key","th","classList","add","setAttribute","appender","tableHeaders","getConstants","data","length","tableRows","interval","tableBody","childNodes","start","end","slice","row","lastIndex","getRow","entry","toggleAttribute","cellData","cell","inner","rowCell","parent","child","Node","Symbol","iterator","Object","textContent","normalize","timeoutId","clear","LdodTable","HTMLElement","constructor","super","this","bind","getAttribute","numberOfVisibleRows","dataset","rows","isFullyLoaded","language","searchkey","searchInput","targetToObserve","querySelectorAll","nrOfTr","Math","floor","observedAttributes","searchedRows","allRows","filter","hasAttribute","unSearchedRows","Array","from","connectedCallback","render","handleLazyRenderRows","history","state","searchTerm","handleSearchInput","addEventListeners","addEventListener","debounce","delay","fn","addObserver","attributeChangedCallback","name","oldV","newV","onChangeAttribute","forEach","ele","firstChild","obsCallback","observer","intersectionRatio","unobserve","target","addRows","observe","obs","IntersectionObserver","dispatchCustomEvent","loadSearchStyle","resolve","then","tools","style","default","isSearching","disconnect","value","trim","toLowerCase","toString","replaceState","result","search","includes","indexOf","size","event","detail","dispatchEvent","CustomEvent","bubbles","composed","customElements","get","define"],"mappings":"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"}