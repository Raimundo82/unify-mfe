import{d as e,e as t,f as s,g as a,r as o,h as r}from"./api-requests-4b63daad.js";import{createElement as i,createFragment as n}from"@core";import"@ui/modal-bs.js";import"@ui/table.js";import{exportButton as l,uploadButton as d}from"@ui/buttons.js";import u from"@ui/bootstrap/root-css.js";import c from"@ui/bootstrap/forms-css.js";import p from"@ui/bootstrap/buttons-css.js";import{errorPublisher as m,messagePublisher as h}from"./events-modules-f7c3e7bf.js";import{getUser as b,setState as g}from"./store-495a4209.js";import"./user-references-3af1d170.js";const f={sessionListHeaders:["username","firstName","lastName","lastRequest","sessionId"],usersListHeaders:["username","firstName","lastName","enabled","roles","lastLogin","active","actions"],pt:{TRUE:"Sim",FALSE:"Não",users:"Utilizadores",user:"Utilizador",admin:"Administrador",sessions:"Sessões",username:"Nome de utilizador",firstName:"Primeiro nome",lastName:"Apelido",lastRequest:"Último Pedido",sessionId:"ID da Sessão",enabled:"Confirmado",roles:"Papeis",lastLogin:"Último acesso",actions:"Acções",active:"Ativo",tooltipActions:"Editar/Eliminar",editUserHeader:"Alterar utilizador",update:"Atualizar",email:"Endereço eletrónico",newPassword:"Nova Senha",toggleActiveMode:"Alterar estado ativo",changeLdodMode:"Alterar modo do LdoD",deleteUserSessions:"Eliminar sessões de utilizador",userMode:"Modo utilizador",adminMode:"Modo administrador",uploadUsers:"Carregar Utilizadores",exportUsers:"Exportar Utilizadores"},en:{TRUE:"Yes",FALSE:"No",users:"Users",user:"User",admin:"Administrator",sessions:"Sessions",username:"Username",firstName:"First Name",lastName:"Last Name",lastRequest:"Last Request",sessionId:"Session ID",enabled:"Enabled",roles:"Roles",lastLogin:"Last login",actions:"Actions",active:"Active",tooltipActions:"Edit/Delete",editUserHeader:"Edit user",update:"Update",email:"Email",newPassword:"New Password",toggleActiveMode:"Toggle active state",changeLdodMode:"Change LdoD mode",deleteUserSessions:"Delete user sessions",userMode:"User mode",adminMode:"Administrator mode",uploadUsers:"Upload Users",exportUsers:"Export Users"},es:{TRUE:"Sí",FALSE:"No",users:"Usuarios",user:"Usuario",admin:"Administrador",sessions:"Sesiones",username:"Nombre de usuario",firstName:"Primer nombre",lastName:"Apellido",lastRequest:"Última Petición",sessionId:"ID de sesión",enabled:"Confirmado",roles:"Funciones",lastLogin:"Último acceso",actions:"Acciones",active:"Activo",tooltipActions:"Editar/Eliminar",editUserHeader:"Editar usuario",update:"Actualizar",email:"Correo electrónico",newPassword:"Nueva contraseña",toggleActiveMode:"Cambiar estado activo",changeLdodMode:"Cambiar el modo LdoD",deleteUserSessions:"Eliminar sesiones de usuario",userMode:"Modo de usuario",adminMode:"Modo administrador",uploadUsers:"Carregar Usuarios",exportUsers:"Exportar Usuarios"}},v=({user:e,root:t})=>i("div",null,i("form",{role:"form",onSubmit:t.onUpdate},i("div",{class:"form-floating"},i("input",{id:"firstname",class:"form-control",type:"text",placeholder:"firstname",name:"firstName",value:e.firstName}),i("label",{"data-users-key":"firstName"},t.getConstant("firstName"))),i("div",{class:"form-floating"},i("input",{id:"lastname",class:"form-control",type:"text",name:"lastName",placeholder:"lastname",value:e.lastName}),i("label",{"data-users-key":"lastName"},t.getConstant("lastName"))),i("div",{class:"form-floating"},i("input",{type:"hidden",value:e.username,name:"oldUsername"}),i("input",{class:"form-control",id:"username",type:"text",name:"newUsername",placeholder:"username",value:e.username}),i("label",{for:"username","data-users-key":"username"},t.getConstant("username"))),i("div",{class:"form-floating"},i("input",{id:"newPassword",class:"form-control",type:"text",name:"newPassword",placeholder:t.getConstant("newPassword")}),i("label",{for:"newPassoword","data-users-key":"newPassword"},t.getConstant("newPassword"))),i("div",{class:"form-floating"},i("input",{id:"email",class:"form-control",type:"text",name:"email",placeholder:"email",value:e.email}),i("label",{for:"email","data-users-key":"email"},t.getConstant("email"))),i("div",null,i("div",null,i("label",{"data-users-key":"user"},t.getConstant("user")),i("div",null,i("label",{class:"switch"},i("input",{name:"user",type:"checkbox",value:"true",checked:e.roles.includes("ROLE_USER")}),i("span",{class:"slider round"})))),i("div",null,i("label",{"data-users-key":"admin"},t.getConstant("admin")),i("div",null,i("label",{class:"switch"},i("input",{name:"admin",value:"true",type:"checkbox",checked:e.roles.includes("ROLE_ADMIN")}),i("span",{class:"slider round"})))),i("div",null,i("label",{"data-users-key":"enabled"},t.getConstant("enabled")),i("div",null,i("label",{class:"switch"},i("input",{name:"enabled",type:"checkbox",value:"true",checked:e.enabled}),i("span",{class:"slider round"}))))),i("button",{type:"submit",class:"btn btn-primary","data-users-key":"update"},t.getConstant("update")))),y=(e,t)=>{const s=w(e,t);e.shadowRoot.querySelector(`#active-${t.externalId}`).replaceWith(s)},w=(t,s)=>{const a=s.active,o=s.externalId;return i("div",{id:`active-${o}`,class:"text-center"},i("button",{id:`button-active-${o}`,class:"btn btn-sm",onClick:()=>(async(t,s)=>{e(t).then((e=>{const a=s.usersData.userList.find((e=>e.externalId===t));a.active=e.ok,y(s,a)}))})(o,t)},i("span",{is:"ldod-span-icon",icon:a?"circle-check":"circle-xmark",fill:a?"#198754":"#dc3545",size:"1.25rem"})))},x=(e,t)=>{const s=t.username,a=t.externalId;return i("div",{class:"text-center"},i("div",{id:"row-user-actions"},i("span",{id:`edit-icon-${a}`,"data-id":a,is:"ldod-span-icon",icon:"pen-to-square",fill:"#0d6efd",size:"1.25rem",onClick:t=>(async({target:e},t)=>{const s=t.usersData.userList.find((({externalId:t})=>t===e.dataset.id)),a=t.usersEditModal;if(!a)return;const o=a.querySelector("div[slot='body-slot']");o.innerHTML="",o.appendChild(i(v,{user:s,root:t})),a.toggleAttribute("show")})(t,e)}),i("span",{id:`trash-icon-${a}`,"data-id":a,"data-username":s,is:"ldod-span-icon",icon:"trash-can",fill:"#dc3545",size:"1.25rem",onClick:e.onDeleteUser})))},C=({root:e})=>{const t=e.usersData,s=e.language;return i("div",null,i("div",{id:"users-list",class:"row"},i("ldod-table",{id:"user-users-list-table",classes:"table table-responsive-sm table-striped table-bordered",headers:f.usersListHeaders,data:t.userList.map((t=>({...t,enabled:i("div",{"data-users-key":String(t.enabled).toUpperCase()},e.getConstant(String(t.enabled).toUpperCase())),active:w(e,t),actions:x(e,t),search:Object.values(t).reduce(((e,t)=>e.concat(String(t),",")),"")}))),constants:f[s],"data-searchkey":"externalId"}),i("ldod-tooltip",{"data-ref":"table>thead>tr>th[data-key='actions']","data-users-tooltip-key":"tooltipActions",placement:"top",content:e.getConstant("tooltipActions")}),i("ldod-tooltip",{placement:"top","data-ref":"table>thead>tr>th[data-key='active']","data-users-tooltip-key":"toggleActiveMode",content:e.getConstant("toggleActiveMode")})))},k=({root:e,title:t})=>i("h2",{id:"title",class:"text-center"},i("span",{"data-users-key":"users"},t),i("span",null," (",e.usersLength,")")),U=({root:e,buttonLabel:s,tooltipContent:a})=>{const o=()=>"admin"===e.getMode()?"btn btn-danger ellipsis":"btn btn-success ellipsis";return i("div",{id:"adminMode",class:"row btn-row"},i("button",{id:"user-switch-mode-button","tooltip-ref":"switch-button",type:"button",class:o(),onClick:()=>{t().then((t=>{t&&e.setMode(t.ok);const s=e.shadowRoot.querySelector("button#user-switch-mode-button");s.querySelector("span[label]").textContent=e.getConstant(`${e.getMode()}Mode`),s.setAttribute("class",o())}))}},i("span",{class:"icon icon-edit"}),i("span",{label:!0},s)),i("ldod-tooltip",{placement:"top","data-ref":"[tooltip-ref='switch-button']","data-users-tooltip-key":"changeLdodMode",content:a}))},S=({root:e})=>i("div",{id:"sessions-list",class:"row"},i("ldod-table",{id:"user-sessionsListTable",classes:"table table-responsive-sm table-striped table-bordered",headers:f.sessionListHeaders,data:e.usersData.sessionList.map((e=>({...e,search:Object.values(e).reduce(((e,t)=>e.concat(String(t),",")),"")}))),language:e.language,constants:f,"data-searchkey":"sessionId"})),L=({root:e,content:t})=>i("div",{id:"deleteSessions",class:"row btn-row"},i("button",{"tooltip-ref":"delete-sessions-button",type:"button",class:"btn btn-danger ellipsis",onClick:()=>{s().then((t=>{e.usersData.sessionList=t.sessionList,e.shadowRoot.querySelector("div#sessions-list").replaceChildren(i(S,{root:e}))}))}},i("span",{class:"icon icon-edit"}),i("span",{label:!0,"data-key":"deleteUserSessions"},t)),i("ldod-tooltip",{placement:"top","data-ref":"[tooltip-ref='delete-sessions-button']","data-users-tooltip-key":"deleteUserSessions",content:t})),A=new CSSStyleSheet;async function E(){await import("@ui/tooltip.js")}A.replaceSync(u+c+p+'.switch{position:relative;display:inline-block;width:60px;height:34px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;inset:0;background-color:#ccc;-webkit-transition:.4s;transition:.4s}.slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background-color:#fff;-webkit-transition:.4s;transition:.4s}input:checked+.slider{background-color:#2196f3}input:focus+.slider{box-shadow:0 0 1px #2196f3}input:checked+.slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(26px);transform:translate(26px)}.slider.round{border-radius:34px}.slider.round:before{border-radius:50%}\ndiv[topic][show]{display:block}div[topic]:not([show]){display:none}.upload-export-users,div#sessions-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin:30px 0}div#sessions-actions button{width:100%;min-width:250px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}@media (width < 768px){.upload-export-users,div#sessions-actions{grid-template-columns:1fr}}span[is=ldod-span-icon]{cursor:pointer}div#row-user-actions{display:flex;justify-content:center;gap:4px;margin-top:5px}span[label]{margin-left:5px}.flex-center{display:flex;justify-content:center}table#user-users-list-table>thead>tr>th:nth-child(4),table#user-users-list-table>thead>tr>th:nth-child(5),table#user-users-list-table>thead>tr>th:nth-child(6),table#user-users-list-table>thead>tr>th:nth-child(7),table#user-users-list-table>thead>tr>th:nth-child(8),table#user-users-list-table>tbody>tr>td:nth-child(4),table#user-users-list-table>tbody>tr>td:nth-child(5),table#user-users-list-table>tbody>tr>td:nth-child(6),table#user-users-list-table>tbody>tr>td:nth-child(7){text-align:center}table#user-sessionsListTable th{text-align:start}form{display:grid;grid-template-columns:repeat(2,1fr);gap:1em}form>:nth-child(5){grid-column:1/ -1}form>:nth-child(6){grid-column:1/ -1;display:grid;grid-template-columns:repeat(3,1fr)}form>:nth-child(7){margin-top:1em;grid-column:2/ -1;justify-self:end;width:min-content}\n'),l(),d();class M extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[A]}static get observedAttributes(){return["language"]}get language(){return this.getAttribute("language")}get usersLength(){return this.usersData?.userList?.length}get usersEditModal(){return this.shadowRoot.querySelector("ldod-bs-modal")}getData(){return Promise.resolve(a().then((e=>this.usersData=e)).catch((e=>console.error(e))))}getConstant(e){return f[this.language][e]}connectedCallback(){this.getData().then((()=>{var e;this.usersData&&(this.shadowRoot.innerHTML=`\n\t\t\t\t<div class="container"></div>\n\t\t\t\t${e=this,`\n\t\t<ldod-bs-modal dialog-class="modal-xl" id="user-update-user-modal">\n\t\t\t<h4 data-users-key="editUserHeader" slot="header-slot">\n\t\t\t\t${e.getConstant("editUserHeader")}\n\t\t\t</h4>\n\t\t\t<div slot="body-slot"></div>\n\t\t</ldod-bs-modal>`}\n\t\t\t`,this.render())}))}render(){var e;this.shadowRoot.firstElementChild.replaceWith(i("div",{class:"container"},i(n,null,i("button",{style:{margin:"1em 0"},class:"btn btn-secondary",type:"button",onClick:(e=this).onSwitchTopic},"Switch to sessions"),i("div",{id:"users",topic:"users",show:!0},i(k,{root:e,title:e.getConstant("users")}),i("div",{class:"upload-export-users"},i("ldod-upload",{"data-users-key":"uploadUsers",title:e.getConstant("uploadUsers"),"data-url":"/admin/user/upload-users"}),i("ldod-export",{"file-prefix":"users","data-users-key":"exportUsers",title:e.getConstant("exportUsers"),"data-url":"/admin/user/export-users"})),i(C,{root:e})),i("div",{id:"sessions",topic:"sessions"},i("h2",{class:"text-center","data-users-key":"sessions"},e.getConstant("sessions")),i("div",{id:"sessions-actions"},i(U,{root:e,buttonLabel:e.getConstant(`${e.getMode()}Mode`),tooltipContent:e.getConstant("changeLdodMode")}),i(L,{root:e,content:e.getConstant("deleteUserSessions")})),i(S,{root:e}))))),this.addEventListeners()}attributeChangedCallback(e,t,s){this.handlers[e](t,s)}handlers={language:(e,t)=>{e&&t!==e&&this.handleChangeLanguage()}};handleChangeLanguage(){this.shadowRoot.querySelectorAll("[data-key]").forEach((e=>{e.textContent=this.getConstant(e.dataset.key)})),this.shadowRoot.querySelectorAll("[data-users-key]").forEach((e=>{e.textContent=this.getConstant(e.dataset.usersKey)})),this.shadowRoot.querySelectorAll("[title]").forEach((e=>{e.setAttribute("title",this.getConstant(e.dataset.usersKey))})),this.shadowRoot.querySelectorAll("[data-users-tooltip-key]").forEach((e=>{e.setAttribute("content",this.getConstant(e.dataset.usersTooltipKey))})),this.shadowRoot.querySelectorAll("[language]").forEach((e=>e.setAttribute("language",this.language)))}addEventListeners(){this.addEventListener("ldod:file-uploaded",this.handleUsersUpload),this.shadowRoot.querySelector("div.container").addEventListener("pointerenter",E,{once:!0}),this.addEventListener("ldod-table-searched",this.updateUsersListTitleOnSearch)}handleUsersUpload=e=>{e.stopPropagation();const t=e.detail.payload;if(!t.ok)return m(t.message);this.getData().then((()=>{this.render(),h(t.message)}))};updateUsersListTitleOnSearch=({detail:e})=>{if("user-users-list-table"===e.id){const e=this.shadowRoot.querySelectorAll("table#user-users-list-table tr[searched]").length;this.shadowRoot.querySelector("h2#title :not([data-users-key])").innerHTML=`&nbsp;(${e})`}};getMode(){return this.usersData.ldoDAdmin?"admin":"user"}setMode(e){this.usersData.ldoDAdmin=e}onSwitchTopic=e=>{this.shadowRoot.querySelectorAll("div[topic]").forEach((e=>e.toggleAttribute("show"))),e.target.textContent=`Switch to ${this.shadowRoot.querySelector("div[topic]:not([show])")?.id}`};onDeleteUser=({target:e})=>{confirm(`Delete user ${e.dataset.username} ?`)&&o(e.dataset.id).then((e=>{this.usersData.userList=e.userList,this.render()})).catch((e=>console.error(e)))};onUpdate=e=>{e.preventDefault();const t=Object.fromEntries(new FormData(e.target));r(t).then((({userList:e})=>{this.usersData.userList=e,function(e,t){const s=t.find((t=>t.username===e.newUsername));b().username===e.newUsername&&g((e=>({...e,user:s})))}(t,e),this.usersEditModal.toggleAttribute("show"),this.render()})).catch((e=>console.error(e)))}}!customElements.get("ldod-manage-users")&&customElements.define("ldod-manage-users",M);const D=async(e,t)=>{const s=document.createElement("ldod-manage-users");s.setAttribute("language",e),document.querySelector(t).appendChild(s)},N=()=>document.querySelector("manage-users")?.remove(),R="/manage-users";export{D as mount,R as path,N as unMount};
//# sourceMappingURL=manage-users-ce591de9.js.map
