import{createElement as e,createFragment as t,ldodEventBus as a}from"@core";import{d as r,r as o,a as n}from"./api-requests-c6fca00d.js";const l=(t,a)=>e("div",{id:`remove-container-${a}`,class:"text-center","tooltip-ref":`remove-container-${a}`},e("span",{id:`xmark-icon-${a}`,"data-id":a,class:"icon icon-xmark",onClick:t.handleRemoveFragment}),e("ldod-tooltip",{"data-ref":`div#remove-container-${a}`,"data-tooltipkey":"removeFragment",placement:"top",content:t.getConstants("removeFragment")})),s=(t,a)=>e("div",{id:`export-container-${a}`,class:"text-center","tooltip-ref":`export-container-${a}`,onClick:({target:e})=>{const a=e.dataset.id;t.querySelector(`table#manageFragmentsTable>tbody>tr[id="${a}"]`).toggleAttribute("selected");const r=t.exportSelectedElement;r.body=r.body.some((e=>e===a))?r.body.filter((e=>e!==a)):[...r.body,a]}},e("span",{id:`dark-export-icon-${a}`,"data-id":a,class:"icon icon-dark-export"}),e("span",{hidden:!0,id:`checked-icon-${a}`,"data-id":a,class:"icon icon-checked"}),e("ldod-tooltip",{"data-ref":`div#export-container-${a}`,"data-tooltipkey":"select",placement:"top",content:t.getConstants("select")})),d=e=>e.fragments?.map((({externalId:t,title:a,xmlId:r})=>({externalId:t,title:a,xmlId:r,remove:l(e,t),export:s(e,t)})))?.map((e=>({...e,search:Object.values(e).reduce(((e,t)=>e.concat(t.toString(),",")),"")})));await import("@ui/table.js");const i=({node:a,constants:r})=>e(t,null,e("ldod-table",{id:"manageFragmentsTable","tooltip-ref":!0,classes:"table table-bordered table-hover",headers:r.headers,data:d(a),language:a.language,constants:r,"data-searchkey":"externalId"}),e("ldod-tooltip",{"data-ref":"thead>tr>th[data-key='export']","data-tooltipkey":"unselectAll",placement:"top",content:a.getConstants("unselectAll")})),m=({numberOfFragments:t,title:a})=>e("h3",{id:"title","data-key":"manageFragments","data-args":t,class:"text-center"},a),p={headers:["xmlId","title","remove","export"],pt:{manageFragments:e=>`Gerir Fragmentos (${e})`,xmlId:"XML ID",title:"Título",remove:"Remover",export:"Exportar",removeFragment:"Remover fragmento",removeAll:"Remover todos os fragmentos",exportAll:"Exportar arquivo completo",exportSelected:"Exportar Fragmentos selecionados",exportRandom:"Exportar 3 fragmentos aleatórios",select:"Clique para selecionar/desselecionar",unselectAll:"Clique para desselecionar todos",uploadSingle:"Carregar ficheiro TEI com Fragmento",uploadMultiple:"Carregar vários ficheiros TEI Fragmentos",uploadCorpus:"Carregar ficheiro TEI com Corpus"},en:{manageFragments:e=>`Manage Fragments (${e})`,xmlId:"XML ID",title:"Title",remove:"Remove",export:"Export",removeFragment:"Remove Fragment",removeAll:"Remove all fragments",exportAll:"Export entire archive",exportSelected:"Export selected Fragments",exportRandom:"Export 3 random fragments",select:"Click to select/unselect",unselectAll:"Click to unselect all",uploadSingle:"Upload TEI Fragment file",uploadMultiple:"Upload multiple TEI Fragment files",uploadCorpus:"Upload TEI Corpus file"},es:{manageFragments:e=>`Administrar Fragmentos (${e})`,xmlId:"XML ID",title:"Título",remove:"Remover",export:"Exportar",removeFragment:"Eliminar fragmento",removeAll:"Remover todos os fragmentos",exportAll:"Exportar todos os Fragmentos",exportSelected:"Exportar Fragmentos selecionados",exportRandom:"Exportar 3 fragmentos aleatórios",select:"Clique para selecionar/desselecionar",unselectAll:"Clique para desselecionar todos",uploadSingle:"Carregar Fragmento",uploadMultiple:"Carregar vários Fragmentos",uploadCorpus:"Carregar ficheiro TEI com Corpus"}};import("@ui/buttons.js").then((({uploadButton:e})=>e()));const u="/text/admin",g=({uploadSingle:t,uploadMultiple:a,uploadCorpus:r})=>e("div",{class:"export-row"},e("ldod-upload",{width:"600px","data-button-key":"uploadCorpus",title:r,"data-url":`${u}/upload-corpus`}),e("ldod-upload",{width:"600px","data-button-key":"uploadSingle",title:t,"data-url":`${u}/upload-fragment`}),e("ldod-upload",{width:"600px",multiple:!0,"data-button-key":"uploadMultiple",title:a,"data-url":`${u}/upload-fragments`}));import("@ui/buttons.js").then((({exportButton:e})=>e()));const c="/text/admin",h=({exportAll:t,exportSelected:a,exportRandom:r})=>e("div",{class:"export-row"},e("ldod-export",{width:"350px","data-button-key":"exportAll",title:t,"file-prefix":"exported-file","data-url":`${c}/export-all`,method:"GET"}),e("ldod-export",{id:"exportSelected",width:"350px","data-button-key":"exportSelected",title:a,"file-prefix":"exported-file","data-url":`${c}/export-fragments`,method:"POST",body:[]}),e("ldod-export",{width:"350px","data-button-key":"exportRandom",title:r,"file-prefix":"exported-file","data-url":`${c}/export-random`,method:"GET"}));async function x(){await import("@ui/tooltip.js")}import("@ui/buttons.js").then((({ldodButton:e})=>e()));class f extends HTMLElement{constructor(){super()}get selectedRows(){return this.querySelectorAll("table>tbody>tr[selected]")}get exportSelectedElement(){return this.querySelector('ldod-export[id="exportSelected"]')}get exportHeadElement(){return this.querySelector("thead>tr>th[data-key='export']")}get language(){return this.getAttribute("language")}get wrapper(){return this.querySelector("div#manageFragmentsWrapper")}get numberOfFragments(){return this.fragments.length}static get observedAttributes(){return["language"]}getSelectedFrags(){return JSON.stringify(this.selectedFrags)}getConstants(e,...t){const a=p[this.language][e];return t.length?a(...t):a}async connectedCallback(){this.fragments=await r.adminFragments,this.appendChild(e("div",{id:"manageFragmentsWrapper"})),this.render()}render(){this.wrapper.innerHTML="",this.wrapper.appendChild(e(t,null,e(m,{title:this.getConstants("manageFragments",this.numberOfFragments),numberOfFragments:this.numberOfFragments}),e("div",{id:"removeAllContainer",class:"text-center"},e("ldod-button",{class:"btn btn-danger","data-button-key":"removeAll",title:this.getConstants("removeAll"),onClick:this.handleRemoveAll})),e("div",{class:"buttons-column"},e(g,{uploadSingle:this.getConstants("uploadSingle"),uploadMultiple:this.getConstants("uploadMultiple"),uploadCorpus:this.getConstants("uploadCorpus")}),e(h,{exportAll:this.getConstants("exportAll"),exportSelected:this.getConstants("exportSelected"),exportRandom:this.getConstants("exportRandom"),node:this})),e(i,{node:this,constants:p}))),this.addEventListeners()}attributeChangedCallback(e,t,a){this.handeChangedAttribute[e](t,a)}handeChangedAttribute={language:(e,t)=>{e&&e!==t&&(this.querySelectorAll("[data-key]").forEach((e=>e.firstChild.textContent=e.dataset.args?this.getConstants(e.dataset.key,JSON.parse(e.dataset.args)):this.getConstants(e.dataset.key))),this.querySelectorAll("[data-tooltipkey]").forEach((e=>{e.setAttribute("content",this.getConstants(e.dataset.tooltipkey))})),this.querySelectorAll("[data-button-key]").forEach((e=>{e.setAttribute("title",this.getConstants(e.dataset.buttonKey))})))}};addEventListeners(){this.wrapper.addEventListener("pointerenter",x),this.exportHeadElement?.addEventListener("click",this.unselectAll),this.addEventListener("ldod:file-uploaded",this.handleFileUploaded),this.addEventListener("ldod-table-searched",this.updateTitle)}updateTitle=({detail:e})=>{this.querySelector("h3#title").firstChild.textContent=this.getConstants("manageFragments",e.size)};unselectAll=()=>{this.selectedRows.forEach((e=>e.toggleAttribute("selected"))),this.exportSelectedElement.body=[]};handleFileUploaded=({detail:{payload:e}})=>{if(!e)return;if("ok"in e)return this.handleMessageOnUploadedFile(e.ok,e.message);r.reset=!0;const t=document.createElement("br").outerHTML,o=document.createElement("p").outerHTML;e.forEach((e=>{const{xmlId:t,uploaded:a,overwritten:r}=e;a&&(r&&this.removeFragmentByXmlId(t),this.mutateFragments(this.addFragment(e)))}));const n=e.filter((e=>e.uploaded)),l=e.filter((e=>!e.uploaded)),s=n.reduce(((e,{xmlId:a,title:r,overwritten:o})=>`${e}${t}[${a}(${r})]${o?" (overwritten)":""}`),`New uploaded fragments: ${n.length}`),d=l.reduce(((e,{xmlId:a,title:r,overwritten:o})=>`${e}${t}[${a}(${r})]${o?" (overwritten)":""}`),`\nAlready uploaded fragments: ${l.length}`);a.publish("ldod:message",s.concat(`${o}`,d))};handleMessageOnUploadedFile=(e,t)=>{a.publish(e?"ldod:message":"ldod:error",t)};handleRemoveAll=async()=>{if(!confirm("Are you sure you want to remove all fragments?"))return;const e=await o();e.ok&&this.mutateFragments([]);const t=e.ok?"ldod:message":"ldod:error";a.publish(t,e.message)};handleRemoveFragment=async({target:e})=>{const t=e.dataset.id,r=await n(e.dataset.id);if(r.ok)return this.mutateFragments(this.removeFragmentById(t));a.publish("ldod:error",r.message)};removeFragmentById(e){return this.fragments.filter((t=>t.externalId!==e))}removeFragmentByXmlId(e){this.fragments=this.fragments.filter((t=>t.xmlId!==e))}addFragment(e){return this.fragments.reverse().push(e),this.fragments.reverse()}mutateFragments(e){this.fragments=e,this.render()}}!customElements.get("ldod-manage-fragments")&&customElements.define("ldod-manage-fragments",f);const v=async(t,a)=>{document.querySelector(a).appendChild(e("ldod-manage-fragments",{language:t}))},b=()=>document.querySelector("ldod-manage-fragments")?.remove(),C="/manage-fragments";export{v as mount,C as path,b as unMount};
//# sourceMappingURL=manageFragments-b59326e3.js.map
