import"@ui/nav-dropdown.js";import e from"@ui/bootstrap/transitions-css.js";const t=()=>console.warn("eventBus not found"),n=globalThis.eventBus??{publisher:t,subscribe:t,register:t};class s extends HTMLLIElement{constructor(){super()}get items(){return Array.from(this.children)}connectedCallback(){this.unsub=n.subscribe("ldod:language",!0,(({payload:e})=>{this.language=e,this.setActive(),this.addEventListeners()})).unsubscribe,this.unsub()}addEventListeners=()=>{this.items.forEach((e=>e.addEventListener("click",this.updateLanguage)))};updateLanguage=e=>{e.stopPropagation(),this.language=e.target.id,this.setActive(),n.publish("ldod:language",this.language)};setActive(){this.items.forEach((e=>{e.classList.remove("active"),e.id===this.language&&e.classList.add("active")}))}}customElements.define("lang-drop",s,{extends:"li"});const a={type:"object",required:["pt","en","es"],properties:{pt:{type:"object"},en:{type:"object"},es:{type:"object"}}},o={type:"object",required:["name","data"],properties:{name:{type:"string"},data:{type:"object",required:["name","links"],properties:{name:{type:"string"},links:{type:"array",items:{type:"object",required:["key"],properties:{key:{type:"string"},route:{type:"string"},link:{type:"string"}}}}}},replace:{type:"boolean"},constants:a}},r=(e,t,n)=>`\n  <a class="dropdown-toggle nav-link" role="button" key="user">\n    ${e}\n    <span class="caret"></span>\n  </a>\n  <ul class="dropdown-menu">\n    ${i(t,n)}\n  </ul>`,i=({constants:e,links:t},n)=>t.map((({key:t,path:s})=>`\n\t\t\t<a is="nav-to" class="dropdown-item" data-key="${t}" to="${s}" key="user">\n\t\t\t\t${e[n]?.[t]??t}\n\t\t\t</a>`)).join(""),d={type:"object",required:["name","data"],properties:{name:{type:"string"},data:{type:"object",required:["links"],properties:{links:{type:"array",items:{type:"object",required:["key","path"],properties:{key:{type:"string"},path:{type:"string"}}}},constants:a}},isAuth:{type:"boolean"}}};class l extends HTMLLIElement{constructor(){super(),n.register("navbar:auth-status",d),n.subscribe("navbar:auth-status",this.render)}static observedAttributes=["language"];get language(){return this.getAttribute("language")}attributeChangedCallback(e,t,n){"language"===e&&t&&t!==n&&this.onLanguage()}onLanguage=()=>{this.querySelectorAll("[data-key]").forEach((e=>{e.textContent=this.constants?.[this.language]?.[e.dataset.key]??key}))};render=({payload:e})=>{this.constants=e.data.constants,this.innerHTML=(({isAuth:e,data:t,name:n},s)=>e?r(n,t,s):i(t,s))(e,this.language)}}customElements.define("user-auth-menu",l,{extends:"li"});const u={en:{header_title:"LdoD Archive"},pt:{header_title:"Arquivo LdoD"},es:{header_title:"Archivo LdoD"}},h=new CSSStyleSheet;let c;h.replaceSync(e);class g extends HTMLElement{constructor(){return super(),this.isRendered=this.shadowRoot?.innerHTML,n.register("ldod:header",o),n.subscribe("ldod:header",this.onMenuCallback),this.isRendered||this.attachShadow({mode:"open"}),this.headersToConsume=[],g.instance||(g.instance=this),g.instance}static get observedAttributes(){return["language"]}get language(){return this.getAttribute("language")||"en"}get dropdowns(){return this.shadowRoot.querySelectorAll("li[is='nav-dropdown']")}get userComponents(){return this.shadowRoot.querySelectorAll("li[is='user-auth-menu']")}get collapseToggler(){return this.shadowRoot.querySelector('button[data-bs-toggle="collapse"]')}get dropItems(){return Array.from(this.shadowRoot.querySelectorAll(".dropdown-menu a.dropdown-item"))}get reference(){return this.shadowRoot.querySelector("div#reference")}get dropdownSize(){return this.shadowRoot.querySelectorAll("li[is='nav-dropdown']").length+1}async connectedCallback(){this.isRendered||(this.shadowRoot.innerHTML=await async function(e){return(await import("./nav-bar-html-1b39f35f.js")).default(e)}(this.language),this.isRendered=!0,this.consumeHeaders()),this.shadowRoot.adoptedStyleSheets=[h],window.addEventListener("pointermove",this.render,{once:!0})}disconnectedCallback(){this.unsubLogout?.(),this.unsubLogin?.()}attributeChangedCallback(e,t,n){this.handleChangedAttribute[e](t,n)}render=async()=>{await this.createInstances(),this.addEventListeners(),this.setDropDownMaxWidth()};async createInstances(){await(async()=>{c=(await import("@ui/bootstrap/collapse.js")).default})().then((()=>{this.collapses=Array.from(this.shadowRoot.querySelectorAll(".collapse")).map((e=>new c(e,{toggle:!1})))}))}addEventListeners(){this.collapseToggler?.addEventListener("click",this.onToggler),document.addEventListener("click",(e=>{this.contains(e.target)||this.toggleDropdownMenu(e)})),this.shadowRoot.addEventListener("click",this.toggleDropdownMenu),this.shadowRoot.addEventListener("click",(e=>{e.target.classList.contains("dropdown-item")&&this.shadowRoot.querySelector("#navbar-nav").classList.remove("show")}))}setDropDownMaxWidth(){h.insertRule(`ul.navbar-nav>li{max-width: ${100/this.dropdownSize}%}`)}onToggler=()=>this.collapses.forEach((e=>{e.toggle()}));toggleDropdownMenu=e=>{const t=e.target.getAttribute("key");this.dropdowns.forEach((e=>{if(e.key===t)return e.toggleAttribute("show");e.toggleAttribute("show",!1)})),this.userComponents.forEach((e=>{if(e.getAttribute("key")===t)return this.toggleUserComponentMenu(e);this.toggleUserComponentMenu(e,!1)}))};toggleUserComponentMenu=(e,t=void 0)=>{if(void 0===t)return e.querySelectorAll("a.dropdown-toggle, ul.dropdown-menu").forEach((e=>{e.classList.toggle("show")}));e.querySelectorAll("a.dropdown-toggle, ul.dropdown-menu").forEach((e=>e.classList.toggle("show",t)))};handleChangedAttribute={language:(e,t)=>e!==t&&this.onLanguageChange()};onLanguageChange(){this.shadowRoot.querySelectorAll("[language]").forEach((e=>{e.setAttribute("language",this.language)})),this.shadowRoot.querySelectorAll("[data-navbar-key]").forEach((e=>{e.textContent=u[this.language][e.dataset.navbarKey]}))}onMenuCallback=({payload:e})=>{const t=this.getNavbarMenuByKey(e.name);if(t)t.onNewLink({payload:e});else{const t=this.newMenu(e);this.addMenu(t)}};newMenu=e=>{const t=document.createElement("template");return t.innerHTML=`\n\t\t<li\n\t\t\t${e.hidden?"hidden":""} \n\t\t\tis="nav-dropdown"\n\t\t\tkey="${e.name}"\n\t\t\tlanguage="${this.language}"\n\t\t\tdata-headers='${JSON.stringify(e)}'\n\t\t></li>`,t.content.firstElementChild.cloneNode(!0)};addMenu(e){if(!this.checkNavBarRenderedAndValid(e))return;const t=e.getAttribute("key"),n="admin"===t?"afterend":"beforebegin";(this.getNavbarMenuByKey(t)||this.reference).insertAdjacentElement(n,e)}consumeHeaders(){for(;this.headersToConsume.length;)this.addMenu(this.headersToConsume.pop())}checkNavBarRenderedAndValid(e){return this.isRendered||this.headersToConsume.push(e),this.isRendered&&e instanceof HTMLLIElement&&this.dropdownSize<10}getNavbarMenuByKey=e=>this.shadowRoot.querySelector(`li[is='nav-dropdown'][key='${e}']`);setMenuVis=(e,t)=>{const n=this.getNavbarMenuByKey(e);n&&(n.hidden=t)}}!customElements.get("nav-bar")&&customElements.define("nav-bar",g);
//# sourceMappingURL=nav-bar-70dcc18e.js.map
