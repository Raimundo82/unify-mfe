{"version":3,"file":"manage-ve-4fa1f8c4.js","sources":["../src/pages/manage-ve/api-requests.js","../src/pages/manage-ve/ve-manage-table.jsx","../src/pages/manage-ve/ldod-manage-ve.jsx","../src/pages/manage-ve/manage-ve-component.jsx","../src/pages/manage-ve/manage-ve.jsx"],"sourcesContent":["/** @format */\n\nimport { fetcher } from '@core';\n\nconst PATH = `/virtual/admin`;\n\nexport const getVirtualEditions4Manage = async () =>\n\tawait fetcher.get(`${PATH}/virtual-editions`, null);\n\nexport const deleteVE = async id => await fetcher.get(`${PATH}/virtual-edition-delete/${id}`, null);\n","/** @format */\n\nexport default ({ root }) => {\n\treturn (\n\t\t<ldod-table\n\t\t\tid=\"virtual-manageVeTable\"\n\t\t\tclasses=\"table table-bordered table-hover\"\n\t\t\theaders={root.constants.headersManage}\n\t\t\tdata={root.virtualEditions.map(row => ({\n\t\t\t\texternalId: row.externalId,\n\t\t\t\tdata: () => ({\n\t\t\t\t\tacronym: row.acronym,\n\t\t\t\t\ttitle: row.title,\n\t\t\t\t\teditors: row.activeMembers.join(', '),\n\t\t\t\t\tcategories: row.categories.join(', '),\n\t\t\t\t\tannotations: row.annotations.join(', '),\n\t\t\t\t\tremove: (\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tid={row.externalId}\n\t\t\t\t\t\t\tdata-acrn={row.acronym}\n\t\t\t\t\t\t\tclass=\"icon icon-trash\"\n\t\t\t\t\t\t\tonClick={root.handleRemoveVE}></span>\n\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\t\tsearch: JSON.stringify(row),\n\t\t\t}))}\n\t\t\tconstants={root.constants}\n\t\t\tlanguage={root.language}\n\t\t\tdata-searchkey=\"externalId\"></ldod-table>\n\t);\n};\n","/** @format */\n\nimport { deleteVE, getVirtualEditions4Manage } from './api-requests';\nimport constants from '../constants';\nimport VeManageTable from './ve-manage-table';\nimport { errorPublisher, messagePublisher } from '../../event-module';\nimport manageVeComponent from './manage-ve-component';\n\nimport.meta.env.DEV ? await import('@ui/table-dev.js') : await import('@ui/table.js');\n\nimport('@ui/buttons.js').then(({ exportButton, uploadButton }) => {\n\texportButton();\n\tuploadButton();\n});\n\nexport class LdodManageVE extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tget constants() {\n\t\treturn constants;\n\t}\n\n\tget language() {\n\t\treturn this.getAttribute('language');\n\t}\n\n\tget wrapper() {\n\t\treturn this.querySelector('div#manageVeWrapper') || <div id=\"manageVeWrapper\"></div>;\n\t}\n\n\tget table() {\n\t\treturn this.querySelector('#virtual-manageVeTable');\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['language'];\n\t}\n\n\tgetConstants(key, ...args) {\n\t\tconst constant = constants[this.language][key];\n\t\treturn args.length ? constant(...args) : constant;\n\t}\n\n\tconnectedCallback() {\n\t\tthis.appendChild(this.wrapper);\n\t\tthis.addEventListeners();\n\t}\n\n\tupdateData = data => {\n\t\tthis.virtualEditions = data;\n\t\tthis.render();\n\t};\n\n\trender() {\n\t\tthis.wrapper.innerHTML = '';\n\t\tthis.wrapper.appendChild(manageVeComponent(this));\n\t}\n\n\tattributeChangedCallback(name, oldV, newV) {\n\t\tthis.handleChangedAttribute[name](oldV, newV);\n\t}\n\n\thandleChangedAttribute = {\n\t\tlanguage: (oldV, newV) => {\n\t\t\tif (oldV && oldV !== newV) {\n\t\t\t\tthis.updateElementContent();\n\t\t\t\tthis.updateTooltipContent();\n\t\t\t\tthis.updateButtonContent();\n\t\t\t}\n\t\t},\n\t};\n\n\taddEventListeners = () => {\n\t\tthis.addEventListener('ldod:file-uploaded', this.handleFileUploaded);\n\t\tthis.addEventListener('ldod-table-searched', this.updateTitle);\n\t};\n\n\thandleFileUploaded = e => {\n\t\te.stopPropagation();\n\t\tconst payload = e.detail.payload;\n\t\tif (!payload.ok) return errorPublisher(payload.message);\n\t\tgetVirtualEditions4Manage()\n\t\t\t.then(data => {\n\t\t\t\tthis.updateData(data);\n\t\t\t\tmessagePublisher(payload.message);\n\t\t\t})\n\t\t\t.catch(error => console.error(error));\n\t};\n\n\tupdateTitle = ({ detail }) => {\n\t\tthis.querySelector('h3>span').textContent = ` (${detail.size})`;\n\t};\n\n\thandleRemoveVE = async ({ target }) => {\n\t\tconfirm(`Are you sure you want to remove the Virtual Edition ${target.dataset.acrn} ?`) &&\n\t\t\tdeleteVE(target.id)\n\t\t\t\t.then(data => {\n\t\t\t\t\tthis.virtualEditions = data || [];\n\t\t\t\t\tthis.render();\n\t\t\t\t})\n\t\t\t\t.catch(console.error);\n\t};\n\n\tupdateElementContent = () => {\n\t\tthis.querySelectorAll('[data-virtual-key]').forEach(node => {\n\t\t\treturn (node.firstChild.textContent = node.dataset.args\n\t\t\t\t? this.getConstants(node.dataset.virtualKey, JSON.parse(node.dataset.args))\n\t\t\t\t: this.getConstants(node.dataset.virtualKey));\n\t\t});\n\t};\n\n\tupdateButtonContent = () => {\n\t\tthis.querySelectorAll('[data-virtual-button-key]').forEach(btn => {\n\t\t\tbtn.setAttribute('title', this.getConstants(btn.dataset.virtualButtonKey));\n\t\t});\n\t};\n\n\tupdateTooltipContent = () => {\n\t\tthis.querySelectorAll('[data-virtual-tooltip-key]').forEach(ele => {\n\t\t\tele.setAttribute('content', this.getConstants(ele.dataset.virtualTooltipKey));\n\t\t});\n\t};\n}\n\n!customElements.get('ldod-manage-ve') && customElements.define('ldod-manage-ve', LdodManageVE);\n","/** @format */\n\nimport { LdodManageVE } from './ldod-manage-ve';\nimport VeManageTable from './ve-manage-table';\n\n/**\n * @param {LdodManageVE} root\n */\nexport default root => {\n\treturn (\n\t\t<>\n\t\t\t<h3 class=\"text-center\" data-virtual-key=\"manageVE\">\n\t\t\t\t{root.getConstants('manageVE')}\n\t\t\t\t<span>{` (${root.virtualEditions.length})`}</span>\n\t\t\t</h3>\n\t\t\t<div class=\"flex-row\">\n\t\t\t\t<div class=\"flex-column\">\n\t\t\t\t\t<ldod-upload\n\t\t\t\t\t\tid=\"corpus\"\n\t\t\t\t\t\twidth=\"600px\"\n\t\t\t\t\t\tdata-virtual-button-key=\"uploadVeCorpus\"\n\t\t\t\t\t\ttitle={root.getConstants('uploadVeCorpus')}\n\t\t\t\t\t\tdata-url={`/virtual/admin/upload-virtual-corpus`}></ldod-upload>\n\t\t\t\t\t<ldod-upload\n\t\t\t\t\t\tid=\"fragments\"\n\t\t\t\t\t\twidth=\"600px\"\n\t\t\t\t\t\tdata-virtual-button-key=\"uploadVeFragments\"\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\ttitle={root.getConstants('uploadVeFragments')}\n\t\t\t\t\t\tdata-url={`/virtual/admin/upload-virtual-fragments`}></ldod-upload>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex-column\">\n\t\t\t\t\t<ldod-export\n\t\t\t\t\t\twidth=\"350px\"\n\t\t\t\t\t\tfile-type=\"zip\"\n\t\t\t\t\t\tdata-virtual-button-key=\"exportVe\"\n\t\t\t\t\t\ttitle={root.getConstants('exportVe')}\n\t\t\t\t\t\tfile-prefix=\"VirtualEditionsFragments\"\n\t\t\t\t\t\tdata-url={`/virtual/admin/export-virtual-editions`}\n\t\t\t\t\t\tmethod=\"GET\"></ldod-export>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<VeManageTable root={root} />\n\t\t\t</div>\n\t\t</>\n\t);\n};\n","import { getVirtualEditions4Manage } from './api-requests.js';\nimport './ldod-manage-ve';\n\nconst mount = async (lang, ref) => {\n  getVirtualEditions4Manage()\n    .then((data) => manageVe.updateData(data))\n    .catch((error) => console.error(error));\n\n  const manageVe = document\n    .querySelector(ref)\n    .appendChild(\n      <ldod-manage-ve language={lang} virtualEditions={[]}></ldod-manage-ve>\n    );\n};\n\nconst unMount = () => document.querySelector('ldod-manage-ve')?.remove();\n\nconst path = '/manage-virtual-editions';\n\nexport { mount, unMount, path };\n"],"names":["PATH","getVirtualEditions4Manage","async","fetcher","get","VeManageTable","root","createElement","id","classes","headers","constants","headersManage","data","virtualEditions","map","row","externalId","acronym","title","editors","activeMembers","join","categories","annotations","remove","class","onClick","handleRemoveVE","search","JSON","stringify","language","import","then","exportButton","uploadButton","LdodManageVE","HTMLElement","constructor","this","getAttribute","wrapper","querySelector","table","observedAttributes","getConstants","key","args","constant","length","connectedCallback","appendChild","addEventListeners","updateData","render","innerHTML","createFragment","width","multiple","method","attributeChangedCallback","name","oldV","newV","handleChangedAttribute","updateElementContent","updateTooltipContent","updateButtonContent","addEventListener","handleFileUploaded","updateTitle","e","stopPropagation","payload","detail","ok","errorPublisher","message","messagePublisher","catch","console","error","textContent","size","target","confirm","dataset","acrn","deleteVE","querySelectorAll","forEach","node","firstChild","virtualKey","parse","btn","setAttribute","virtualButtonKey","ele","virtualTooltipKey","customElements","define","mount","lang","ref","manageVe","document","unMount","path"],"mappings":"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"}