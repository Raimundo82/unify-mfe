import{c as e,s as t,g as r,a as n}from"./style-6fcaeb80.js";import{selectedVEs as a,updateSelecteVEs as s}from"./event-module-0f223477.js";import{references as i}from"./virtual.js";import"@core";const d=(e,t)=>e.map((e=>({name:e.acronym,url:i.virtualEdition(e.acronym),add:e.canAddInter&&e.member,interId:e.interExternalId,veId:e.veExternalId,inters:e.inters.map((e=>({externalId:e.externalId,previous:{xmlId:e.prevXmlId,urlId:e.prevUrlId},current:{xmlId:e.xmlId,urlId:e.urlId,name:e.number.toString()},next:{xmlId:e.nextXmlId,urlId:e.nextUrlId},checked:t.includes(e.externalId)})))}))),l=({lang:t,virtualEditions:r,intersChecked:n})=>{const a="virtual";return`<frag-nav-panel id="${a}" data-input='${function(t,r,n){return JSON.stringify({type:e[r][t],tooltip:e[r][`${t}Tooltip`],data:n})}(a,t,d(r,n.map((e=>e.externalId))))}'></frag-nav-panel>`};const h=new CSSStyleSheet;h.replaceSync(t);class u extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[h],this.intersChecked=[],this.veId="",this.interId="",u.instance=this}get urlId(){return this.getAttribute("urlid")}get fragment(){return this.getAttribute("fragment")}get language(){return this.getAttribute("language")}static get observedAttributes(){return["language"]}getConstants(t){return e[this.language][t]}updateSelectedInters=()=>{this.urlId&&(this.intersChecked=this.virtualEditions.flatMap((e=>e.inters.filter((e=>e.urlId===this.urlId)))))};async connectedCallback(){this.addEventListener("virtual:changed",this.onCheckboxChange),this.addEventListener("virtual:clicked",this.addInterToVe),this.fragment&&await this.navDataRequest(),this.updateSelectedInters(),this.render()}navDataRequest=async()=>{await r(this.fragment,{veIds:a,currentInterId:1===this.intersChecked?.length?this.intersChecked[0].externalId:null,urlId:this.urlId}).then((e=>{s(e.map((e=>({name:e.acronym,selected:!0})))),this.virtualEditions=e})).catch((e=>console.error(e)))};interAddRequest=async()=>{await n(this.fragment,this.veId,this.interId,{veIds:a,currentInterId:1===this.intersChecked.length&&this.intersChecked[0].externalId}).then((e=>this.virtualEditions=e)).catch((e=>console.error(e)))};render(){this.shadowRoot.innerHTML=l({lang:this.language,intersChecked:this.intersChecked,virtualEditions:this.virtualEditions})}onCheckboxChange=async({detail:e})=>{this.updateInters(e),this.dispatchEvent(new CustomEvent("virtual:inter-selected",{detail:{virtualInters:e.selected?.length},composed:!0,bubbles:!0})),this.intersChecked.length&&(await this.navDataRequest(),this.render())};updateInters=e=>{this.intersChecked=e.selected.map((e=>({externalId:e.id,urlId:e.name})))};addInterToVe=async({detail:e})=>{const t=e.target;this.veId=t.dataset.veId,this.interId=t.dataset.interId,await this.interAddRequest(),this.render()}}!customElements.get("virtual-frag-nav")&&customElements.define("virtual-frag-nav",u);export{u as VirtualFragNav};
//# sourceMappingURL=virtual-frag-nav-123d436f.js.map
