{"version":3,"file":"ldod-ve-assisted-61276c63.js","sources":["../src/pages/virtual-editions/pages/index/components/assisted/assisted-table.jsx","../src/pages/virtual-editions/pages/index/components/assisted/properties-form.jsx","../src/pages/virtual-editions/pages/index/components/assisted/ldod-ve-assisted.jsx"],"sourcesContent":["/** @format */\n\nimport { setLinearVE } from '@src/restricted-api-requests';\nimport { isDev } from '@src/utils';\nimport { textFragmentInter } from '../../../../../../external-deps';\n\nconst initialProperties = [\n\t{ type: 'heteronym', weight: '0' },\n\t{ type: 'date', weight: '0' },\n\t{ type: 'text', weight: '0' },\n\t{ type: 'taxonomy', weight: '0' },\n];\n\nlet properties = initialProperties;\n\nexport const useProperties = () => {\n\tconst getProperties = acronym =>\n\t\t(properties ?? initialProperties).map(prop => ({ ...prop, acronym }));\n\tconst setProps = (props = initialProperties) => (properties = props);\n\treturn [getProperties, setProps];\n};\nconst [getProperties, setProps] = useProperties();\n\nconst onSetAsInitial = async (node, inter) => {\n\tsetProps(node.properties);\n\tconst data = await setLinearVE(node.edition.externalId, {\n\t\tselected: inter.externalId,\n\t\tproperties: getProperties(inter.shortName),\n\t});\n\n\tnode.updateData(data);\n};\n\nconst getTableData = node => {\n\treturn node.inters.map(inter => {\n\t\tconst useInter = inter.usedList[0];\n\t\treturn {\n\t\t\texternalId: inter.externalId,\n\t\t\tnumber: inter.number,\n\t\t\ttitle: inter.title,\n\t\t\tselected:\n\t\t\t\tnode.selected !== inter.externalId ? (\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-outline-primary btn-sm\"\n\t\t\t\t\t\tonClick={() => onSetAsInitial(node, inter)}>\n\t\t\t\t\t\t{node.getConstants('defineFirst')}\n\t\t\t\t\t</button>\n\t\t\t\t) : (\n\t\t\t\t\t''\n\t\t\t\t),\n\t\t\tuseEdition: (\n\t\t\t\t<a\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tis=\"nav-to\"\n\t\t\t\t\tto={`${isDev() ? '' : '/ldod-mfes'}${textFragmentInter(\n\t\t\t\t\t\tuseInter.xmlId,\n\t\t\t\t\t\tuseInter.urlId\n\t\t\t\t\t)}`}>\n\t\t\t\t\t{`-> ${useInter.shortName}`}\n\t\t\t\t</a>\n\t\t\t),\n\t\t\tsearch: JSON.stringify(inter),\n\t\t};\n\t});\n};\n\nexport default ({ node }) => {\n\treturn (\n\t\t<ldod-table\n\t\t\tlanguage={node.language}\n\t\t\tid=\"virtual-assistedTable\"\n\t\t\tclasses=\"table  table-hover\"\n\t\t\theaders={node.constants.assistedHeaders}\n\t\t\tdata={getTableData(node)}\n\t\t\tconstants={node.constants}\n\t\t\tdata-searchkey=\"externalId\"></ldod-table>\n\t);\n};\n","import style from './properties-style.css?inline';\nimport { useProperties } from './assisted-table';\nimport { setLinearVE } from '@src/restricted-api-requests';\n\nconst getRangeInputs = (node) =>\n  Array.from(node.shadowRoot.querySelectorAll('input[type=\"range\"]'));\n\nconst onChangeProperty = async (node) => {\n  let props = getRangeInputs(node).map((input) => ({\n    type: input.name,\n    weight: input.value,\n  }));\n\n  node.properties.set(props);\n  const data = await setLinearVE(node.parent.edition.externalId, {\n    selected: node.parent.selected,\n    properties: node.properties.get(node.parent.edition.acronym),\n  });\n  node.parent.updateData(data);\n};\n\nconst getForm = (node, parent) => {\n  return (\n    <form>\n      <h4 class=\"text-center\">{parent.getConstants('criteria')}</h4>\n      <div\n        style={{\n          display: 'grid',\n          gap: '20px',\n          margin: '20px',\n          justifyContent: 'space-evenly',\n          gridTemplateColumns: 'auto auto auto auto',\n        }}>\n        {['heteronym', 'date', 'text', 'taxonomy'].map((prop) => (\n          <div class=\" text-center\">\n            <label for={`range-${prop}`}>{parent.getConstants(prop)}</label>\n            <input\n              onChange={() => onChangeProperty(node)}\n              id={`range-${prop}`}\n              name={prop}\n              type=\"range\"\n              max=\"1\"\n              min=\"0\"\n              step=\"0.2\"\n              value={`${parent.properties?.filter(({ type }) => prop === type)[0]\n                ?.weight || 0\n                }`}\n            />\n          </div>\n        ))}\n      </div>\n    </form>\n  );\n};\n\nexport class PropertiesForm extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n  }\n\n  static get observedAttributes() { }\n\n  get properties() {\n    const [get, set] = useProperties();\n    return {\n      get,\n      set,\n    };\n  }\n\n  connectedCallback() {\n    this.properties.set();\n    this.shadowRoot.appendChild(<style>{style}</style>);\n    this.shadowRoot.appendChild(getForm(this, this.parent));\n  }\n  attributeChangedCallback() { }\n  disconnectedCallback() { }\n}\n!customElements.get('properties-form') &&\n  customElements.define('properties-form', PropertiesForm);\n","/** @format */\n\nimport thisConstants from './constants';\nimport constants from '@src/pages/constants';\nimport AssistedTable from './assisted-table';\nimport './properties-form';\nimport { saveLinerVE } from '@src/restricted-api-requests';\nimport style from './style.css?inline';\nimport formStyle from '@ui/bootstrap/forms-css.js';\nimport buttonsStyle from '@ui/bootstrap/buttons-css.js';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(style + buttonsStyle + formStyle);\nexport class LdodVeAssisted extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.attachShadow({ mode: 'open' });\n\t\tthis.shadowRoot.adoptedStyleSheets = [sheet];\n\t\tthis.constants = Object.entries(thisConstants).reduce((prev, [key, value]) => {\n\t\t\tprev[key] = value instanceof Array ? value : { ...constants[key], ...value };\n\t\t\treturn prev;\n\t\t}, {});\n\t}\n\n\tget language() {\n\t\treturn this.getAttribute('language');\n\t}\n\n\tget show() {\n\t\treturn this.hasAttribute('show');\n\t}\n\n\tget modal() {\n\t\treturn this.shadowRoot.querySelector('#virtual-veAssisted');\n\t}\n\n\tget table() {\n\t\treturn this.shadowRoot.querySelector('ldod-table#virtual-assistedTable');\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['show'];\n\t}\n\tgetConstants(key) {\n\t\treturn this.constants[this.language][key];\n\t}\n\tconnectedCallback() {\n\t\tthis.addEventListener('ldod-modal-close', this.onCloseModal);\n\t}\n\n\tattributeChangedCallback(name, oldV, newV) {\n\t\tthis.onChangedAttribute[name](oldV, newV);\n\t}\n\n\tonCloseModal = () => {\n\t\tthis.toggleAttribute('show', false);\n\t\tthis.shadowRoot.innerHTML = '';\n\t};\n\n\tonSave = async () => {\n\t\tconst data = await saveLinerVE(\n\t\t\tthis.edition.externalId,\n\t\t\tthis.inters.map(({ externalId }) => externalId)\n\t\t);\n\t\tthis.shadowRoot\n\t\t\t.querySelector('properties-form')\n\t\t\t.shadowRoot.querySelectorAll('input[type=\"range\"]')\n\t\t\t.forEach(input => (input.value = 0));\n\t\tthis.updateData(data);\n\t};\n\n\trender() {\n\t\tthis.shadowRoot.appendChild(\n\t\t\t<ldod-bs-modal id=\"virtual-veAssisted\" dialog-class=\"modal-fullscreen\">\n\t\t\t\t<h5 slot=\"header-slot\">{this.edition?.title}</h5>\n\t\t\t\t<div slot=\"body-slot\">\n\t\t\t\t\t<properties-form parent={this}></properties-form>\n\t\t\t\t\t<AssistedTable node={this} />\n\t\t\t\t</div>\n\t\t\t\t<div slot=\"footer-slot\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" onClick={this.onSave}>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tis=\"ldod-span-icon\"\n\t\t\t\t\t\t\ticon=\"floppy-disk\"\n\t\t\t\t\t\t\tfill=\"#fff\"\n\t\t\t\t\t\t\tsize=\"16px\"\n\t\t\t\t\t\t\tstyle={{ marginRight: '8px' }}></span>\n\t\t\t\t\t\t{this.getConstants('save')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</ldod-bs-modal>\n\t\t);\n\t}\n\n\tupdateData = ({ inters, selected, properties }) => {\n\t\tthis.inters = inters;\n\t\tthis.selected = selected;\n\t\tthis.properties = properties?.map(({ title, acronym, weight }) => ({\n\t\t\ttype: title.toLowerCase(),\n\t\t\tacronym,\n\t\t\tweight,\n\t\t}));\n\t\tthis.reRenderTable();\n\t};\n\n\treRenderTable() {\n\t\tconsole.log(this.table);\n\t\tthis.table?.replaceWith(<AssistedTable node={this} />);\n\t}\n\n\tonChangedAttribute = {\n\t\tshow: () => {\n\t\t\tconsole.log('show');\n\t\t\tthis.show && this.render();\n\t\t\tthis.modal?.toggleAttribute('show', this.show);\n\t\t},\n\t};\n}\n!customElements.get('ldod-ve-assisted') &&\n\tcustomElements.define('ldod-ve-assisted', LdodVeAssisted);\n"],"names":["initialProperties","type","weight","properties","useProperties","acronym","map","prop","props","getProperties","setProps","getTableData","node","inters","inter","useInter","usedList","externalId","number","title","selected","createElement","class","onClick","async","data","setLinearVE","edition","shortName","updateData","onSetAsInitial","getConstants","useEdition","target","is","to","textFragmentInter","xmlId","urlId","search","JSON","stringify","AssistedTable","language","id","classes","headers","constants","assistedHeaders","onChangeProperty","Array","from","shadowRoot","querySelectorAll","getRangeInputs","input","name","value","set","parent","get","PropertiesForm","HTMLElement","constructor","super","this","attachShadow","mode","observedAttributes","connectedCallback","appendChild","style","display","gap","margin","justifyContent","gridTemplateColumns","for","onChange","max","min","step","filter","attributeChangedCallback","disconnectedCallback","customElements","define","sheet","CSSStyleSheet","replaceSync","buttonsStyle","formStyle","LdodVeAssisted","adoptedStyleSheets","Object","entries","thisConstants","reduce","prev","key","getAttribute","show","hasAttribute","modal","querySelector","table","addEventListener","onCloseModal","oldV","newV","onChangedAttribute","toggleAttribute","innerHTML","onSave","saveLinerVE","forEach","render","slot","icon","fill","size","marginRight","toLowerCase","reRenderTable","console","log","replaceWith"],"mappings":"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"}