import{errorPublisher as t}from"./event-module-0f223477.js";import{c as e}from"./utils-a4875c44.js";import{c as a,b as s,d as i,s as n,e as r,f as o}from"./style-6fcaeb80.js";import"./virtual.js";import"@core";const l=new(await customElements.whenDefined("annotator-service"));class h extends HTMLElement{constructor(){super(),this.taxonomy=void 0,this.inters=[],this.constants=a}get xmlId(){return this.getAttribute("xmlid")}get urlId(){return this.getAttribute("urlId")}get singleInter(){return this.inters[0]}get language(){return this.getAttribute("language")}get associateTagModal(){return document.body.querySelector("ldod-bs-modal#virtual--associate-tag-modal")}get associateTagModalSelect(){return this.associateTagModal.querySelector("select-pure#virtual-associateTag")}static get observedAttributes(){return["language"]}getConstants(t){return this.constants[this.language][t]}getIntersChecked=()=>customElements.get("virtual-frag-nav").instance.intersChecked;fetchVirtualFragmentInter=(t,e)=>s(t,e).then((t=>{this.inters=[t.inter],this.taxonomy=t.taxonomy,this.annotations=t.annotations})).catch(this.onError);fetchVirtualFragmentInters=(t,e)=>i(t,e).then((t=>this.inters=t)).catch(this.onError);fetchData=async()=>{if(this.xmlId&&(this.urlId||this.getIntersChecked().length))return this.urlId||1===this.getIntersChecked().length?this.fetchVirtualFragmentInter(this.xmlId,this.urlId||this.getIntersChecked()[0].urlId):this.fetchVirtualFragmentInters(this.xmlId,this.getIntersChecked().map((t=>t.externalId)))};async connectedCallback(){await this.fetchData(),this.innerHTML=`<style>${n}</style><div id="virtual-transcriptionWrapper"></div>`,this.wrapper=this.querySelector("div#virtual-transcriptionWrapper"),this.render(),this.addEventListeners()}async render(){if(this.wrapper.innerHTML="",this.inters.length>1)return this.wrapper.appendChild(await async function(t){return(await import("./virtual-inters-compare-81acac8c.js")).default({root:t})}(this));if(this.singleInter){if(this.wrapper.appendChild(await async function(t,e,a){return(await import("./transcription-b2ca6c5c.js")).default({root:t,inter:e,taxonomy:a})}(this,this.singleInter,this.taxonomy)),!l)return;l.annotate({id:this.singleInter.externalId,selector:"div#virtual-nodeReference"})}}addEventListeners(){this.addEventListener("virtual:associate-tag",this.associateTag),this.addEventListener("annotator:annotation-update",(async()=>{await this.fetchData(),this.render()}))}attributeChangedCallback(t,e,a){this.handeChangedAttribute[t](e,a)}handeChangedAttribute={language:(t,e)=>{t&&t!==e&&this.handleChangedLanguage()}};handleChangedLanguage=()=>{this.querySelectorAll("[language]").forEach((t=>t.setAttribute("language",this.language))),this.querySelectorAll("[data-virtual-key]").forEach((t=>{t.firstChild.textContent=this.getConstants(t.dataset.virtualKey)}))};onError=e=>{console.error(e),t(e?.message)};associateTag=async()=>{document.body.appendChild(await async function(t,e){return(await import("./associate-tag-modal-9992ad9e.js")).default({root:t,inter:e})}(this,this.singleInter)),document.body.addEventListener("ldod-modal-close",this.removeModal),this.associateTagModal.toggleAttribute("show",!0)};handleAssociateTag=()=>this.associateTag();computeSelectHeight=()=>{e(this.associateTagModalSelect,80)};dissociateTag=async({target:t})=>{await r(t.dataset.interId,t.dataset.catId).then((t=>{this.inters=[t.inter],this.taxonomy=t.taxonomy})).catch(this.onError),this.render()};onAssociateTags=async()=>{const t=[...new Set(this.associateTagModal?.querySelector("select-pure").values)];await o(this.singleInter.externalId,t).then((t=>{this.inters=[t.inter],this.taxonomy=t.taxonomy,this.removeModal(),this.render()})).catch(this.onError)};removeModal=(t={})=>{t.detail&&"virtual--associate-tag-modal"!==t.detail.id||(document.body.removeEventListener("ldod-modal-close",this.removeModal),this.associateTagModal?.remove())}}async function d(t,e){window.mfes.includes("annotations")&&(l||(l=(await import("http://localhost:9000/ldod-mfes/annotations/annotations.js").catch((t=>console.error(t)))).annotatorService),l({interId:t,referenceNode:e}))}!customElements.get("virtual-transcription")&&customElements.define("virtual-transcription",h);export{h as VirtualTranscription,d as loadAnnotator};
//# sourceMappingURL=virtual-transcription-0848a63b.js.map
