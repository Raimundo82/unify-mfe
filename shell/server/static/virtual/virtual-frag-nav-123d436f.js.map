{"version":3,"file":"virtual-frag-nav-123d436f.js","sources":["../src/fragment/frag-nav.js","../src/fragment/virtual-frag-nav.js"],"sourcesContent":["/** @format */\nimport references from '../references';\nimport constants from './constants';\nconst dataArray = {\n\tvirtual: (data, inters) =>\n\t\tdata.map(entry => ({\n\t\t\tname: entry.acronym,\n\t\t\turl: references.virtualEdition(entry.acronym),\n\t\t\tadd: entry.canAddInter && entry.member,\n\t\t\tinterId: entry.interExternalId,\n\t\t\tveId: entry.veExternalId,\n\t\t\tinters: entry.inters.map(inter => ({\n\t\t\t\texternalId: inter.externalId,\n\t\t\t\tprevious: { xmlId: inter.prevXmlId, urlId: inter.prevUrlId },\n\t\t\t\tcurrent: {\n\t\t\t\t\txmlId: inter.xmlId,\n\t\t\t\t\turlId: inter.urlId,\n\t\t\t\t\tname: inter.number.toString(),\n\t\t\t\t},\n\t\t\t\tnext: { xmlId: inter.nextXmlId, urlId: inter.nextUrlId },\n\t\t\t\tchecked: inters.includes(inter.externalId),\n\t\t\t})),\n\t\t})),\n};\n\nexport default ({ lang, virtualEditions, intersChecked }) => {\n\tconst id = 'virtual';\n\treturn /*html*/ `<frag-nav-panel id=\"${id}\" data-input='${getDataInput(\n\t\tid,\n\t\tlang,\n\t\tdataArray.virtual(\n\t\t\tvirtualEditions,\n\t\t\tintersChecked.map(item => item.externalId)\n\t\t)\n\t)}'></frag-nav-panel>`;\n};\n\nfunction getDataInput(id, lang, data) {\n\treturn JSON.stringify({\n\t\ttype: constants[lang][id],\n\t\ttooltip: constants[lang][`${id}Tooltip`],\n\t\tdata,\n\t});\n}\n","/** @format */\n\nimport constants from './constants';\nimport { selectedVEs, updateSelecteVEs } from '../event-module';\nimport {\n\taddInterRequest,\n\tgetVirtualFragmentNavInters as getNavigationFragmentData,\n} from './api-requests';\nimport fragNav from './frag-nav';\n\nimport style from './style.css?inline';\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(style);\n\nexport class VirtualFragNav extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.attachShadow({ mode: 'open' });\n\t\tthis.shadowRoot.adoptedStyleSheets = [sheet];\n\t\tthis.intersChecked = [];\n\t\tthis.veId = '';\n\t\tthis.interId = '';\n\t\tVirtualFragNav.instance = this;\n\t}\n\n\tget urlId() {\n\t\treturn this.getAttribute('urlid');\n\t}\n\n\tget fragment() {\n\t\treturn this.getAttribute('fragment');\n\t}\n\n\tget language() {\n\t\treturn this.getAttribute('language');\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['language'];\n\t}\n\n\tgetConstants(key) {\n\t\treturn constants[this.language][key];\n\t}\n\n\tupdateSelectedInters = () => {\n\t\tif (this.urlId)\n\t\t\tthis.intersChecked = this.virtualEditions.flatMap(ve =>\n\t\t\t\tve.inters.filter(inter => inter.urlId === this.urlId)\n\t\t\t);\n\t};\n\n\tasync connectedCallback() {\n\t\tthis.addEventListener('virtual:changed', this.onCheckboxChange);\n\t\tthis.addEventListener('virtual:clicked', this.addInterToVe);\n\t\tthis.fragment && (await this.navDataRequest());\n\t\tthis.updateSelectedInters();\n\t\tthis.render();\n\t}\n\n\tnavDataRequest = async () => {\n\t\tawait getNavigationFragmentData(this.fragment, {\n\t\t\tveIds: selectedVEs,\n\t\t\tcurrentInterId:\n\t\t\t\tthis.intersChecked?.length === 1 ? this.intersChecked[0].externalId : null,\n\t\t\turlId: this.urlId,\n\t\t})\n\t\t\t.then(data => {\n\t\t\t\tupdateSelecteVEs(data.map(ved => ({ name: ved.acronym, selected: true })));\n\t\t\t\tthis.virtualEditions = data;\n\t\t\t})\n\t\t\t.catch(error => console.error(error));\n\t};\n\n\tinterAddRequest = async () => {\n\t\tawait addInterRequest(this.fragment, this.veId, this.interId, {\n\t\t\tveIds: selectedVEs,\n\t\t\tcurrentInterId: this.intersChecked.length === 1 && this.intersChecked[0].externalId,\n\t\t})\n\t\t\t.then(data => (this.virtualEditions = data))\n\t\t\t.catch(error => console.error(error));\n\t};\n\n\trender() {\n\t\tthis.shadowRoot.innerHTML = fragNav({\n\t\t\tlang: this.language,\n\t\t\tintersChecked: this.intersChecked,\n\t\t\tvirtualEditions: this.virtualEditions,\n\t\t});\n\t}\n\n\tonCheckboxChange = async ({ detail }) => {\n\t\tthis.updateInters(detail);\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent('virtual:inter-selected', {\n\t\t\t\tdetail: { virtualInters: detail.selected?.length },\n\t\t\t\tcomposed: true,\n\t\t\t\tbubbles: true,\n\t\t\t})\n\t\t);\n\t\tif (!this.intersChecked.length) return;\n\t\tawait this.navDataRequest();\n\t\tthis.render();\n\t};\n\n\tupdateInters = inters => {\n\t\tthis.intersChecked = inters.selected.map(inter => ({\n\t\t\texternalId: inter.id,\n\t\t\turlId: inter.name,\n\t\t}));\n\t};\n\n\taddInterToVe = async ({ detail }) => {\n\t\tconst target = detail.target;\n\t\tthis.veId = target.dataset.veId;\n\t\tthis.interId = target.dataset.interId;\n\t\tawait this.interAddRequest();\n\t\tthis.render();\n\t};\n}\n!customElements.get('virtual-frag-nav') &&\n\tcustomElements.define('virtual-frag-nav', VirtualFragNav);\n"],"names":["dataArray","data","inters","map","entry","name","acronym","url","references","virtualEdition","add","canAddInter","member","interId","interExternalId","veId","veExternalId","inter","externalId","previous","xmlId","prevXmlId","urlId","prevUrlId","current","number","toString","next","nextXmlId","nextUrlId","checked","includes","fragNav","lang","virtualEditions","intersChecked","id","JSON","stringify","type","constants","tooltip","getDataInput","item","sheet","CSSStyleSheet","replaceSync","style","VirtualFragNav","HTMLElement","constructor","this","attachShadow","mode","shadowRoot","adoptedStyleSheets","instance","getAttribute","fragment","language","observedAttributes","getConstants","key","updateSelectedInters","flatMap","ve","filter","async","addEventListener","onCheckboxChange","addInterToVe","navDataRequest","render","getNavigationFragmentData","veIds","selectedVEs","currentInterId","length","then","updateSelecteVEs","ved","selected","catch","error","console","interAddRequest","addInterRequest","innerHTML","detail","updateInters","dispatchEvent","CustomEvent","virtualInters","composed","bubbles","target","dataset","customElements","get","define"],"mappings":"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"}